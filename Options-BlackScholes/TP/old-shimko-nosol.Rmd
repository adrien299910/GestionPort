\SweaveOpts{keep.source=FALSE}
\SweaveOpts{eps=FALSE,pdf=TRUE}
\SweaveOpts{prefix.string=pic/PS-Bonds}

<<PlottingDevices,echo=FALSE,results=hide>>=
options(digits=5)
options(width=60)
options(continue=" ")
options(useFancyQuotes=FALSE)
Sys.setenv(USERNAME = "Rmetrics")
@

\documentclass[10pt]{article}

\input{Problems-Template}

\specialcomment{answer}{
  {
  \pagebreak[3]
  \vspace{5 mm}
  \large\bf\noindent{Answer}
  \vspace{5 mm}
  }
}

\excludecomment{answer}

 
\lfoot{\small\scshape Options and other derivatives - Master SDMR} 
\rfoot{\footnotesize PS \# 2} 

\title{Master SDMR\\
Problem Set 2 \\
Shimko's Model}

\begin{document}

\maketitle
\thispagestyle{empty}

In this problem set, you will use the following functions:

GBSPrice: Price of a vanilla option:
\[
P = f(\text{PutCall}, S, K, T, r, b, \sigma)
\]

where:
\begin{description}
\item[$\text{PutCall}$] 'c' for a call, 'p' for a put
\item[$b$] cost of carry: ridk free rate $r$ less dividend yield $d$
\item[$r$] risk-free rate
\end{description}

<<label=GBSPrice, echo=T>>=
GBSPrice <- function(PutCall, S, K, T, r, b, sigma) {
  d1 <- (log(S/K) + (b+sigma^2/2)*T)/(sigma*sqrt(T))
  d2 <- d1 - sigma*sqrt(T)

  if(PutCall == 'c')  
    px <- S*exp((b-r)*T)*pnorm(d1) - K*exp(-r*T)*pnorm(d2)
  else
    px <- K*exp(-r*T)*pnorm(-d2) - S*exp((b-r)*T)*pnorm(-d1)

px
}
@

GBSVega: Vega ($\frac{\partial P}{\partial \sigma}$) of a Vanilla option:

<<label=GBSVega, echo=T>>=
GBSVega <- function(PutCall, S, K, T, r, b, sigma) {
  d1 <- (log(S/K) + (b+sigma^2/2)*T)/(sigma*sqrt(T))
  S*exp((b-r)*T) * dnorm(d1)
}
@



\begin{problem}{Implied dividend yield and risk-free rate}

We observe a set of call and put prices, maturity 60 days.

The strikes of the options are:
<<echo=T>>=
K <- c(325, 345, 360, 365, 375, 385, 390, 395, 400, 405, 410, 425)
@

The corresponding call prices are:
<<echo=T>>=
C <- c(66.5, 46, 33, 27.75, 20.125, 13.5, 9.625, 7.25, 5.375, 3.375, 1.875, 0.25)
@

The corresponding put prices are:
<<echo=T>>=
P <- c(0.3125, 0.875, 2, 2.625, 4.25, 7.125, 8.75, 11, 13.75, 17, 19.75, 34)
@

The spot is $S_0 = 390.02$. Using the Call-Put parity, estimate by linear regression the implied risk-free rate ($r$) and dividend yield ($d$).
\end{problem}

\begin{problem}{Implied Volatility calculation}

\begin{enumerate}
\item Using the functions above, write a function that computes 
the implied volatility of a Vanilla option. Let:
\[
g(\sigma) := P - f(\text{PutCall}, S, K, T, r, b, \sigma)
\]

where $P$ is the observed price of the option of interest.

We look for the volatility $\sigma$ such that $g(\sigma) = 0$.

The function should have the following signature:

<<label=ImpliedVol, echo=T>>=
ImpliedVol <- function(p, TypeFlag, S, X, Time, r, b, sigma=NULL, maxiter=500, tol=1.e-5) {
}
@

where:
\begin{description}
\item[$p$] price of the option
\item[$sigma$] an optional initial value for the volatility
\item[$maxiter$] an optional maximum number of iterations
\item[$tol$] an optional tolerance for the error $|g(\sigma)|$.
\end{description}

\item Test the accuracy of your procedure on options that are deep in the money and deep out of the money, and report the results of your tests.

\item Compute the implied volatility of the calls and puts in the data set.

\item Fit a quadratic function to the call and put implied volatilities (one function for the calls, one for the puts), and plot actual vs. fitted data. Interpret the results.
\end{enumerate}
\end{problem}

\begin{problem}{Breeden-Litzenberger formula}

Compute the implied density of $S_T$ using the Breeden-Litzenberger formula. Estimate 
\[
\frac{\partial^2 f}{\partial K^2}
\]
by finite difference. Remember that now $\sigma$ is a function of strike. Plot the implied distribution and compare to the distribution implicit in the standard Black-Scholes model. Interpret your observations.
\end{problem}

\begin{problem}{Shimko's Model}

Compute the implied distribution of $S_T$ using Shimko's model and the quadratic smile function estimated above.
Plot this distribution and compare with the result of the Breeden-Litzenberger formula. Interpret your observations.
\end{problem}

\begin{problem}{Pricing a digital call}

Recall that a digital call with strike $K$ pays one euro if $S_T \geq K$, and nothing otherwise.

Using the implied density computed above, compute the price of a digital call by numerical integration.

Perform this calculation for strikes ranging from 350 to 420. Compare with the price obtained using a log-normal distribution for $S_T$. Interpret your observations.
\end{problem}

\end{document}
